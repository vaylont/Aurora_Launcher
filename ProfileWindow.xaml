<Window x:Class="Aurora_Launcher.ProfileWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Icon="/ico.ico"
        Title="Профиль"
        Height="600" Width="800"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Шапка профиля -->
            <RowDefinition Height="*"/>
            <!-- Содержимое списка игр -->
            <RowDefinition Height="Auto"/>
            <!-- Нижние кнопки -->
        </Grid.RowDefinitions>

        <!-- ================= Шапка профиля ================= -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <!-- Аватарка -->
                <ColumnDefinition Width="*"/>
                <!-- Никнейм, баланс, редактирование -->
                <ColumnDefinition Width="Auto"/>
                <!-- Кнопка Выход -->
            </Grid.ColumnDefinitions>

            <!-- Аватарка -->
            <Border Grid.Column="0"
                    Width="100" Height="100"
                    CornerRadius="50"
                    Background="#555"
                    VerticalAlignment="Center">
                <Image x:Name="AvatarImage"
                       Width="100" Height="100"
                       Stretch="UniformToFill"
                       ClipToBounds="True"
                       Source="/Resources/default_avatar.png"/>
            </Border>

            <!-- Никнейм, баланс и кнопка редактирования -->
            <StackPanel Grid.Column="1"
                        Orientation="Vertical"
                        VerticalAlignment="Center"
                        Margin="20,0,0,0">
                <!-- Никнейм -->
                <TextBlock x:Name="NicknameText"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="White"
                           Margin="0,0,0,5"/>

                <!-- Баланс и пополнение -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="BalanceText"
                               FontSize="16"
                               Foreground="LightGreen"
                               VerticalAlignment="Center"/>
                    <Button Content="+"
                            Height="26"
                            Margin="15,0,0,0"
                            Padding="12,0"
                            Background="LightGreen"
                            Foreground="White"
                            FontSize="18"
                            VerticalAlignment="Center"
                            Click="RechargeButton_Click"/>
                </StackPanel>

                <!-- Редактировать профиль -->
                <Button Content="✏️ Редактировать"
                        Width="120" Height="30"
                        Background="#444"
                        Foreground="White"
                        FontWeight="Bold"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Left"
                        Click="EditProfile_Click"/>
            </StackPanel>

            <!-- Кнопка Выход -->
            <Button Grid.Column="2"
                    Content="Выход"
                    Width="80" Height="30"
                    Margin="10,0,0,0"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Right"
                    Background="#AA0000"
                    Foreground="White"
                    Click="Logout_Click"/>
        </Grid>

        <!-- ================ Список купленных игр ================ -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="OwnedGamesList" Margin="0,0,0,10">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#444"
                                BorderThickness="1"
                                Margin="5"
                                Padding="10"
                                Background="#2D2D30"
                                CornerRadius="5"
                                Height="100">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <!-- Обложка -->
                                    <ColumnDefinition Width="*"/>
                                    <!-- Текст и кнопки -->
                                </Grid.ColumnDefinitions>

                                <!-- Обложка игры -->
                                <Image Source="{Binding CoverUrl}"
                                       Width="150" Height="100"
                                       Stretch="UniformToFill"
                                       Margin="0,0,10,0"
                                       Grid.Column="0"/>

                                <!-- Название, кнопки и прогресс -->
                                <StackPanel Grid.Column="1"
                                            VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Title}"
                                               FontSize="16"
                                               Foreground="White"
                                               FontWeight="Bold"
                                               Margin="0,0,0,5"/>
                                    <StackPanel Orientation="Horizontal">
                                        <!-- Установить/Запустить -->
                                        <Button x:Name="InstallButton"
                                                Content="{Binding ButtonText}"
                                                Width="100" Height="25"
                                                Background="{Binding ButtonColor}"
                                                Foreground="White"
                                                Click="InstallButton_Click"
                                                Tag="{Binding GameId}"/>
                                        <!-- Удалить -->
                                        <Button x:Name="DeleteButton"
                                                Content="Удалить"
                                                Width="60" Height="25"
                                                Background="#CC0000"
                                                Foreground="White"
                                                Margin="10,0,0,0"
                                                Click="DeleteButton_Click"
                                                Tag="{Binding GameId}"
                                                Visibility="{Binding IsInstalled, Converter={StaticResource BoolToVis}}"/>
                                    </StackPanel>
                                    <ProgressBar x:Name="InstallProgressBar"
                                                 Minimum="0" Maximum="100"
                                                 Height="10" Width="150"
                                                 Margin="0,5,0,0"
                                                 Visibility="Collapsed"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- ================= Нижние кнопки ================= -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Left"
                    Margin="0,10,0,0">
            <Button Content="← В магазин"
                    Height="35" Width="120"
                    Background="#007ACC"
                    Foreground="White"
                    FontWeight="Bold"
                    Click="BackToShop_Click"/>
            <Button x:Name="AddGameButton"
                    Content="➕ Добавить игру"
                    Height="35" Width="150"
                    Background="#007ACC"
                    Foreground="White"
                    FontWeight="Bold"
                    Margin="10,0,0,0"
                    Visibility="Collapsed"
                    Click="AddGame_Click"/>
            <!-- Кнопка Управление жанрами -->
            <Button x:Name="ManageGenresButton"
            Content="🎭 Жанры"
            Click="ManageGenres_Click"
            Visibility="Collapsed"
            Height="35" Width="120"
            Background="#007ACC"
            Foreground="White"
            FontWeight="Bold"
            Margin="10,0,0,0"/>
            <Button x:Name="StatsButton"
        Content="📊 Статистика"
        Click="ManageStats_Click"
        Height="35" Width="120"
        Background="#007ACC"
        Foreground="White"
        FontWeight="Bold"
        Margin="10,0,0,0"
        Visibility="Collapsed"/>

        </StackPanel>
    </Grid>
</Window>
